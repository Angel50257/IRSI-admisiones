<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Nuevo Aplicante</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-50 min-h-screen p-0 m-0">
  <!-- NAVBAR -->
<nav class="bg-blue-700 shadow-md px-4 py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between fixed top-0 left-0 w-full z-50">
  <div class="flex items-center space-x-4">
    <img src="/static/imagenes/LOGO-IRSI-BLANCO-e1707496362435.png" alt="Logo Empresa" style="width: 120px; height: 50px;" class="rounded-full">
  </div>

  <button onclick="history.back();" class="relative inline-flex items-center justify-center p-0.5 mb-2 me-2 overflow-hidden text-sm font-medium text-blue-900 rounded-lg group bg-gradient-to-br from-cyan-500 to-blue-500 group-hover:from-cyan-500 group-hover:to-blue-500 hover:text-white dark:text-white focus:ring-4 focus:outline-none focus:ring-cyan-200 dark:focus:ring-cyan-800 w-full sm:w-auto">
    <span class="relative px-5 py-2.5 transition-all ease-in duration-75 bg-white dark:bg-blue-900 rounded-md group-hover:bg-transparent group-hover:dark:bg-transparent">
      Regresar
    </span>
  </button>
</nav>


<div class="pt-32 min-h-screen bg-white">
  <div class="max-w-4xl mx-auto p-4 sm:p-6">
    <div class="w-full bg-white p-6 sm:p-10 rounded-2xl shadow-xl">
    <h1 class="text-3xl font-bold text-blue-800 mb-8 text-center">Formulario de Aplicante</h1>
<form id="form-aplicante" action="{{ url_for('aplicantes.crear_aplicante') }}" method="post" class="space-y-6">
      <!-- Fila 1 -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">Nombre completo</label>
          <input type="text" name="nombre_completo" pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ ]{2,100}" title="Ingrese solo letras" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" maxlength="100" required>
        </div>
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">Fecha de nacimiento</label>
          <input type="date" name="fecha_nacimiento" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">No. Documento Único</label>
          <input type="text" name="documento" placeholder="No. Documento Único" pattern="[0-9]{8,20}" title="Ingrese su número de documento (8-20 dígitos)" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>
      </div>

      <!-- Fila 2 -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">País</label>
          <select name="pais" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <option value="">Seleccione un país</option>
            <optgroup label="Centroamérica">
              <option>Guatemala</option>
              <option>El Salvador</option>
              <option>Honduras</option>
              <option>Nicaragua</option>
              <option>Costa Rica</option>
              <option>Panamá</option>
            </optgroup>
            <optgroup label="Norteamérica">
              <option>México</option>
              <option>Estados Unidos</option>
              <option>Canadá</option>
            </optgroup>
            <optgroup label="Sudamérica">
              <option>Argentina</option>
              <option>Bolivia</option>
              <option>Brasil</option>
              <option>Chile</option>
              <option>Colombia</option>
              <option>Ecuador</option>
              <option>Paraguay</option>
              <option>Perú</option>
              <option>Uruguay</option>
              <option>Venezuela</option>
            </optgroup>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">Universidad</label>
          <input type="text" name="universidad" pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ ,.]{2,50}" title="Ingrese solo texto válido" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" maxlength="150" required>
        </div>
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">Carrera</label>
          <input type="text" name="carrera" pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ ,.]{2,50}" title="Ingrese solo texto válido" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" maxlength="100" required>
        </div>
      </div>

      <!-- Fila 3 -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">Último grado académico</label>
          <input type="text" name="ultimo_grado_academico" title="Ingrese solo texto válido" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" maxlength="100" required>
        </div>
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">Email</label>
          <input type="email" name="email" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" maxlength="100" required>
        </div>
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">Teléfono</label>
          <div class="flex items-center">
            <button id="dropdown-phone-button" data-dropdown-toggle="dropdown-phone" type="button" class="shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-blue-900 bg-blue-100 border border-blue-300 rounded-s-lg hover:bg-blue-200 focus:ring-4 focus:outline-none focus:ring-blue-100 dark:bg-blue-700 dark:hover:bg-blue-600 dark:focus:ring-blue-700 dark:text-white dark:border-blue-600">
              <img src="https://flagcdn.com/w40/gt.png" alt="Guatemala" class="w-5 h-4 me-2 rounded-sm">
              +502
              <svg class="w-2.5 h-2.5 ms-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
              </svg>
            </button>
            <div id="dropdown-phone" class="z-10 hidden bg-white divide-y divide-blue-100 rounded-lg shadow-sm w-64 dark:bg-blue-700">
              <ul class="py-2 text-sm text-blue-700 dark:text-blue-200 max-h-64 overflow-y-auto" aria-labelledby="dropdown-phone-button">
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/gt.png" class="w-5 h-4 me-2 rounded-sm">Guatemala (+502)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/sv.png" class="w-5 h-4 me-2 rounded-sm">El Salvador (+503)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/hn.png" class="w-5 h-4 me-2 rounded-sm">Honduras (+504)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/ni.png" class="w-5 h-4 me-2 rounded-sm">Nicaragua (+505)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/cr.png" class="w-5 h-4 me-2 rounded-sm">Costa Rica (+506)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/pa.png" class="w-5 h-4 me-2 rounded-sm">Panamá (+507)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/mx.png" class="w-5 h-4 me-2 rounded-sm">México (+52)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/us.png" class="w-5 h-4 me-2 rounded-sm">Estados Unidos (+1)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/ca.png" class="w-5 h-4 me-2 rounded-sm">Canadá (+1)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/ar.png" class="w-5 h-4 me-2 rounded-sm">Argentina (+54)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/bo.png" class="w-5 h-4 me-2 rounded-sm">Bolivia (+591)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/br.png" class="w-5 h-4 me-2 rounded-sm">Brasil (+55)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/cl.png" class="w-5 h-4 me-2 rounded-sm">Chile (+56)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/co.png" class="w-5 h-4 me-2 rounded-sm">Colombia (+57)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/ec.png" class="w-5 h-4 me-2 rounded-sm">Ecuador (+593)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/py.png" class="w-5 h-4 me-2 rounded-sm">Paraguay (+595)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/pe.png" class="w-5 h-4 me-2 rounded-sm">Perú (+51)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/uy.png" class="w-5 h-4 me-2 rounded-sm">Uruguay (+598)</button></li>
                <li><button type="button" class="inline-flex items-center w-full px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-600"><img src="https://flagcdn.com/w40/ve.png" class="w-5 h-4 me-2 rounded-sm">Venezuela (+58)</button></li>
              </ul>
            </div>
            <input type="text" id="phone-input" name="telefono" class="block p-2.5 w-full z-20 text-sm text-blue-900 bg-blue-50 rounded-e-lg border-s-0 border border-blue-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-blue-700 dark:border-s-blue-700 dark:border-blue-600 dark:placeholder-blue-400 dark:text-white dark:focus:border-blue-500" pattern="\\+?[0-9\\s-]{8,20}" placeholder="123-456-7890" required />
          </div>
        </div>
      </div>


      <!-- Fila 4 -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">Año de aplicación</label>
          <input type="number" name="anio_aplicacion" min="1900" max="2099" title="Ingrese un año válido" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>
        <div>
          <label class="block text-sm font-semibold text-blue-700 mb-1">Observaciones</label>
          <textarea name="observaciones" rows="2" class="w-full border border-blue-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
        </div>
      </div>

      <!-- Botón -->
      <div class="text-center pt-4">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg transition duration-300">
          Enviar
        </button>
      </div>

      <!-- Mensaje -->
      <div id="mensaje" class="mt-4 text-center text-sm font-medium"></div>
    </form>
  </div>

  <script>
    // Maneja envío del formulario
    document.getElementById('form-aplicante').addEventListener('submit', async function (e) {
      e.preventDefault();

      const form = e.target;
      const datos = Object.fromEntries(new FormData(form).entries());

      const response = await fetch('/aplicantes/crear', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(datos)
      });

      const res = await response.json();
      const mensaje = document.getElementById('mensaje');
      mensaje.textContent = res.mensaje || res.error;
      mensaje.className = res.error ? 'text-red-500' : 'text-green-600';
    });

    // Maneja selección de país
    document.querySelectorAll('#dropdown-phone ul button').forEach(item => {
      item.addEventListener('click', function () {
        const button = document.getElementById('dropdown-phone-button');
        const selectedFlag = this.querySelector('img').src;
        const selectedText = this.textContent.trim();
        const countryCode = selectedText.match(/\(\+\d+\)/)[0]; // Ej. "(+502)"

        // Actualiza contenido visual del botón
        button.innerHTML = `
          <img src="${selectedFlag}" alt="Flag" class="w-5 h-4 me-2 rounded-sm">
          ${countryCode}
          <svg class="w-2.5 h-2.5 ms-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
          </svg>
        `;

        // Guarda el código de país sin paréntesis en el input hidden
        document.getElementById('codigo-pais').value = countryCode.replace(/[()]/g, '');
      });
    });
  </script>

  <!-- Flowbite (debe ir al final) -->
  <script src="https://unpkg.com/flowbite@2.3.0/dist/flowbite.min.js"></script>

</body>
</html>
